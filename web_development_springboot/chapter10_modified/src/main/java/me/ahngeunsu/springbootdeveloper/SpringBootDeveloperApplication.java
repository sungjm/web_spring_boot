package me.ahngeunsu.springbootdeveloper;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.data.jpa.repository.config.EnableJpaAuditing;

@EnableJpaAuditing
@SpringBootApplication
public class SpringBootDeveloperApplication {
    public static void main(String[] args) {
        SpringApplication.run(SpringBootDeveloperApplication.class, args);
    }
}
/*
    ì‚¬ì „ ì§€ì‹ : OAuth
        - ì œ 3ì˜ ì„œë¹„ìŠ¤ì— ê³„ì • ê´€ë¦¬ë¥¼ ë§¡ê¸°ëŠ” ë°©ì‹. naver/Google/kakaoë¡œ ë¡œê·¸ì¸í•˜ê¸°ì™€ ê°™ì€ ì˜ˆì‹œ

        ê´€ë ¨ ìš©ì–´ ì •ë¦¬
            ë¦¬ì†ŒìŠ¤ ì˜¤ë„ˆ(Resource Owner) : ì¸ì¦ ì„œë²„ì— ìì‹ ì˜ ì •ë³´ë¥¼ ì‚¬ìš©í•˜ë„ë¡ í—ˆìš©í•˜ëŠ” ì£¼ì²´.
                ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ì‚¬ìš©ìê°€ ë¦¬ì†ŒìŠ¤ ì˜¤ë„ˆì— í•´ë‹¹.
            ë¦¬ì†ŒìŠ¤ ì„œë²„(Resource Server) : ë¦¬ì†ŒìŠ¤ ì˜¤ë„ˆì˜ ì •ë³´ë¥¼ ê°€ì§€ë©°, ë¦¬ì†ŒìŠ¤ ì˜¤ë„ˆì˜ ì •ë³´ë¥¼
                ë³´í˜¸í•˜ëŠ” ì£¼ì²´ë¥¼ ì˜ë¯¸í•˜ê³ , ë„¤ì´ë²„, êµ¬ê¸€, ì¹´ì¹´ì˜¤, í˜ì´ìŠ¤ë¶ì´ ë¦¬ì†ŒìŠ¤ ì„œë²„ì— í•´ë‹¹.
            ì¸ì¦ ì„œë²„(Authorization Server) : í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë¦¬ì†ŒìŠ¤ ì˜¤ë„ˆì˜ ì •ë³´ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”
                í† í°ì„ ë°œê¸‰í•˜ëŠ” ì—­í• ì„ í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì˜ë¯¸
            í´ë¼ì´ì–¸íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜(Client Application) : ì¸ì¦ ì„œë²„ì—ê²Œ ì¸ì¦ì„ ë°›ê³  ë¦¬ì†ŒìŠ¤ ì˜¤ë„ˆì˜
                ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ì£¼ì²´ë¥¼ ì˜ë¯¸.

        OAuthë¥¼ ì‚¬ìš©í•˜ë©´ ì¸ì¦ ì„œë²„ì—ì„œ ë°œê¸‰ë°›ì€ í† í°ì„ ì‚¬ìš©í•´ì„œ ë¦¬ì†ŒìŠ¤ì„œë²„ì—
            ë¦¬ì†ŒìŠ¤ì˜¤ë„ˆì˜ ì •ë³´ë¥¼ ìš”ì²­í•˜ê³  ì‘ë‹µ ë°›ì•„ ì‚¬ìš© ê°€ëŠ¥.
            ê·¸ë ‡ë‹¤ë©´ ë¦¬ì†ŒìŠ¤ì˜¤ë„ˆì˜ ì •ë³´ë¥¼ ì–´ë–»ê²Œ ì·¨ë“í•  ìˆ˜ ìˆëŠ”ì§€ì— ëŒ€í•œ ë°©ë²•ì´ í•„ìš”.

            ë¦¬ì†ŒìŠ¤ ì˜¤ë„ˆ ì •ë³´ë¥¼ ì·¨ë“í•˜ëŠ” ë„¤ ê°€ì§€ ë°©ë²•
                1) ê¶Œí•œ ë¶€ì—¬ ì½”ë“œ ìŠ¹ì¸ íƒ€ì…(Authorization Code Grant Type) :
                    OAuth 2.0ì—ì„œ ê°€ì¥ ëŒ€ì¤‘ì ì¸ ì¸ì¦ ë°©ë²•. í´ë¼ì´ì–¸íŠ¸ê°€ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•˜ëŠ” ë° ì‚¬ìš©.
                    ê¶Œí•œì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì½”ë“œì™€ ë¦¬ì†ŒìŠ¤ ì˜¤ë„ˆì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ í† í°ì„ ë°œê¸‰ë°›ëŠ” ë°©ì‹.

                2) ì•”ì‹œì  ìŠ¹ì¸(Implicit Grant Type) :
                    ì„œë²„ê°€ ì—†ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì£¼ë¡œ ì‚¬ìš©.
                    í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­ì„ ë³´ë‚´ë©´ ë¦¬ì†ŒìŠ¤ ì˜¤ë„ˆì˜ ì¸ì¦ ê³¼ì • ì´ì™¸ì—ëŠ” ê¶Œí•œ ì½”ë“œ êµí™˜ ë“±ì˜
                    ë³„ë‹¤ë¥¸ ì¸ì¦ ê³¼ì •ì„ ê±°ì¹˜ì§€ ì•Šê³  ì•¡ì„¸ìŠ¤ í† í°ì„ ì œê³µ ë°›ëŠ” í˜•ì‹

                3) ë¦¬ì†ŒìŠ¤ ì†Œìœ ì ì•”í˜¸ ìê²©ì¦ëª… ìŠ¹ì¸ íƒ€ì…(Resource Owner Password Credentials) :
                    í´ë¼ì´ì–¸íŠ¸ì˜ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì´ìš©í•´ì„œ ì•¡ì„¸ìŠ¤ í† í°ì— ëŒ€í•œ ì‚¬ìš©ìì˜ ìê²© ì¦ëª…ì„ êµí™˜í•˜ëŠ” ë°©ì‹

                4) í´ë¼ì´ì–¸íŠ¸ ìê²© ì¦ëª… ìŠ¹ì¸ íƒ€ì…(Client Credentials Grant) :
                    í´ë¼ì´ì–¸íŠ¸ê°€ ì»¨í…ìŠ¤íŠ¸ ì™¸ë¶€ì—ì„œ ì•¡ì„¸ìŠ¤ í† í°ì„ ì–»ì–´ íŠ¹ì • ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼ì„ ìš”ì²­í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ë°©ì‹

                ê¶Œí•œ ë¶€ì—¬ ì½”ë“œ ìŠ¹ì¸ íƒ€ì…ì´ë€?
                    ì• í”Œë¦¬ì¼€ì´ì…˜ / ë¦¬ì†ŒìŠ¤ ì˜¤ë„ˆ(ì‚¬ìš©ì) / ë¦¬ì†ŒìŠ¤ ì„œë²„ / ì¸ì¦ ì„œë²„ê°€ ì–´ë–¤ ìˆœì„œë¡œ ì¸ì¦ì„ í•˜ëŠ”ì§€ ì•Œ í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.

                                3. ì¸ì¦ ì½”ë“œ ë°œê¸‰
                ì• í”Œë¦¬ì¼€ì´ì…˜ ----------------------------â†’ ì¸ì¦ ì„œë²„
                    â†‘   \      4. ì•¡ì„¸ìŠ¤ í† í°ìœ¼ë¡œ ë°œê¸‰         â†‘
                    |    \                                  |
                    |     \                                 |
                    |      \                                |
     1. ê¶Œí•œ ìš”ì²­    |       5. ì•¡ì„¸ìŠ¤ í† í°ìœ¼ë¡œ ë°ì´í„°ì— ì ‘ê·¼    | ì¸ì¦ ì„œë²„ì—
                    |                              \        | ì¸ì¦ ì‘ì—… ìœ„ì„
                    |                               \       |
                    |                                \      |
                    |                                 \     |
                    |                                   â†˜   |
                ë¦¬ì†ŒìŠ¤ ì˜¤ë„ˆ â†---------------------------- ë¦¬ì†ŒìŠ¤ ì„œë²„
                              2. ë°ì´í„° ì ‘ê·¼ìš© ê¶Œí•œ ë¶€ì—¬


          1. ê¶Œí•œ ìš”ì²­ :
            ê¶Œí•œ ìš”ì²­ì€ í´ë¼ì´ì–¸íŠ¸, ì¦‰ ìŠ¤í”„ë§ ë¶€íŠ¸ ì„œë²„ê°€ íŠ¹ì • ì‚¬ìš©ì ë°ì´í„°ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ ê¶Œí•œ ì„œë²„,
            ì¦‰ ì¹´ì¹´ì˜¤ë‚˜ êµ¬ê¸€ ê¶Œí•œ ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ëŠ” ê±°ë¼ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš”ì²­ URIëŠ” ê¶Œí•œ ì„œë²„ë§ˆë‹¤ ë‹¤ë¥´ì§€ë§Œ,
            ë³´í†µì€ í´ë¼ì´ì–¸íŠ¸ID, ë¦¬ë‹¤ì´ë ‰íŠ¸ URI, ì‘ë‹µ íƒ€ì… ë“±ì„ íŒŒë¼ë¯¸í„°ë¡œ ë³´ëƒ…ë‹ˆë‹¤.
            ì‹¤ì œ ìš”ì²­ì— ì“°ì´ëŠ” ìš”ì²­ URI ì˜ˆì‹œë¥¼ í†µí•´ ì£¼ìš” íŒŒë¼ë¯¸í„°ë¥¼ ì†Œê°œí•˜ìë©´,

                ğŸê¶Œí•œ ìš”ì²­ì„ ìœ„í•œ íŒŒë¼ë¯¸í„° ì˜ˆ
                GET spring-authorization-server.example/authorize?
                    client_id=66a36b4c2&
                    redirect_uri=http://localhost:8080/myapp&
                    response_type=code&
                    scope=profile

           client_id : ì¸ì¦ ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì— í• ë‹¹í•œ ê³ ìœ  ì‹ë³„ì.
            ì´ ê°’ì€ í´ë¼ì´ì–¸íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ OAuth ì„œë¹„ìŠ¤ì— ë“±ë¡í•  ë•Œ ì„œë¹„ìŠ¤ì—ì„œ ìƒì„±í•˜ëŠ” ê°’

           redirect_uri : ë¡œê·¸ì¸ ì„±ê³µì‹œ ì´ë™í•´ì•¼í•˜ëŠ” URI
           response_type : í´ë¼ì´ì–¸íŠ¸ê°€ ì œê³µë°›ê¸¸ ì›í•˜ëŠ” ì‘ë‹µ íƒ€ì…. ì¸ì¦ ì½”ë“œë¥¼ ë°›ì„ ë•ŒëŠ” codeê°’ì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.
           scope : ì œê³µë°›ê³ ì í•˜ëŠ” ë¦¬ì†ŒìŠ¤ ì˜¤ë„ˆì˜ ì •ë³´ ëª©ë¡

       2. ë°ì´í„° ì ‘ê·¼ìš© ê¶Œí•œ ë¶€ì—¬
        ì¸ì¦ ì„œë²„ì— ìš”ì²­ì„ ì²˜ìŒ ë³´ë‚´ëŠ” ê²½ìš° ì‚¬ìš©ìì—ê²Œ ë³´ì´ëŠ” í˜ì´ì§€ë¥¼ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë³€ê²½í•˜ê³ 
        ì‚¬ìš©ìì˜ ë°ì´í„°ì— ì ‘ê·¼ ë™ì˜ë¥¼ ì–»ìŠµë‹ˆë‹¤. ì´ ê³¼ì •ì€ ìµœì´ˆ 1íšŒë§Œ ì§„í–‰.
        ì´í›„ì—ëŠ” ì¸ì¦ ì„œë²„ì—ì„œ ë™ì˜ ë‚´ìš©ì„ ì €ì¥í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ë¡œê·¸ì¸ë§Œ ì§„í–‰.
        ë¡œê·¸ì¸ ì„±ê³µí•˜ë©´ ê¶Œí•œ ë¶€ì—¬ ì„œë²„ëŠ” ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ì¸ì¦ ë° ê¶Œí•œ ë¶€ì—¬ë¥¼ ìˆ˜ì‹ 

       3. ì¸ì¦ ì½”ë“œ ì œê³µ
        ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´ ê¶Œí•œ ìš”ì²­ ì‹œì— íŒŒë¼ë¯¸í„°ë¡œ ë³´ë‚¸ redirect_urië¡œ ë¦¬ë‹¤ì´ë ‰ì…˜ë©ë‹ˆë‹¤.
        ì´ë•Œ íŒŒë¼ë¯¸í„°ì— ì¸ì¦ ì½”ë“œë¥¼ í•¨ê»˜ ì œê³µí•©ë‹ˆë‹¤.

        ğŸˆ ì¸ì¦ ì½”ë“œ ì˜ˆì‹œ
        GET http://localhost:8080/myapp?code=als2f3mcj2

       4. ì•¡ì„¸ìŠ¤ ì½”ë“œ ì‘ë‹µ
        'ì¸ì¦ ì½”ë“œ'ë¥¼ ë°›ìœ¼ë©´ 'ì•¡ì„¸ìŠ¤ í† í°'ìœ¼ë¡œ êµí™˜í•´ì•¼ í•©ë‹ˆë‹¤.
        ì•¡ì„¸ìŠ¤ í† í°ì€ ë¡œê·¸ì¸ ì„¸ì…˜ì— ëŒ€í•œ ë³´ì•ˆ ìê²©ì„ ì¦ëª…í•˜ëŠ” ì‹ë³„ ì½”ë“œë¥¼ ì˜ë¯¸.
        ë³´í†µ ë‹¤ìŒê³¼ ê°™ì´ /token POST ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.

        ğŸˆ /token POST ìš”ì²­ ì˜ˆì‹œ
        {
            "client_id": "66a36b4c2",
            "client_secret": "aabb11dd44",
            "redirect_uri": "http://localhost:8080/myapp",
            "grant_type": "authorization_code",
            "code": "a1b2c3d4e5f67h8"
        }
                client_secret : OAuth ì„œë¹„ìŠ¤ì— ë“±ë¡í•  ë•Œ ì œê³µë°›ëŠ” ë¹„ë°€í‚¤

                grant_type : ê¶Œí•œ ìœ í˜•ì„ í™•ì¸í•˜ëŠ” ë° ì‚¬ìš©. ì´ ë•ŒëŠ” authorization_codeë¡œ ì„¤ì •í•´ì•¼ í•¨. ê¶Œí•œ ì„œë²„ëŠ” ìš”ì²­ ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ
                    ìœ íš¨í•œ ì •ë³´ì¸ì§€ í™•ì¸í•˜ê³ , ìœ íš¨í•œ ì •ë³´ë¼ë©´ ì•¡ì„¸ìŠ¤ í† í°ìœ¼ë¡œ ì‘ë‹µí•©ë‹ˆë‹¤.

                ğŸì•¡ì„¸ìŠ¤ í† í° ì‘ë‹µ ê°’ì˜ ì˜ˆ
                {
                    "access_token": "aasdffb",
                    "token_type": "Bearer"
                    "expires_in": 3600,
                    "scope": "openid profile"
                ...ìƒëµ...
                }

            5. ì•¡ì„¸ìŠ¤ í† í°ìœ¼ë¡œ API ì‘ë‹µ & ë°˜í™˜
                ì´ì œ ì œê³µë°›ì€ ì•¡ì„¸ìŠ¤ í† í°ìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ ì˜¤ë„ˆì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì •ë³´ê°€ í•„ìš”í•  ë•Œë§ˆë‹¤ API í˜¸ì¶œì„ í†µí•´ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê³ 
                ë¦¬ì†ŒìŠ¤ ì„œë²„ëŠ” í† í°ì´ ìœ íš¨í•œì§€ ê²€ì‚¬í•œ ë’¤ì— ì‘ë‹µí•©ë‹ˆë‹¤.

                ğŸë¦¬ì†ŒìŠ¤ ì˜¤ë„ˆì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ ìš”ì²­ ì˜ˆ
                    GET spring-authorization-resource-server .example.com/userinfo
                    Header: Authorization: Bearer aasdffb

                ì—¬ê¸°ê¹Œì§€ê°€ ê¶Œí•œ ë¶€ì—¬ ì½”ë“œ ìŠ¹ì¸ íƒ€ì…ì˜ íë¦„ì…ë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ OAuthë¥¼ êµ¬í˜„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì´ íë¦„ì„ ë°”íƒ•ìœ¼ë¡œ ì½”ë“œë¥¼ êµ¬í˜„í•˜ê¸° ë•Œë¬¸ì—
                íë¦„ì„ ì´í•´í•˜ê³  ë„˜ì–´ê°€ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

        ì¿ í‚¤ë€?
            ì‚¬ìš©ìê°€ ì–´ë–¤ ì›¹ì‚¬ì´íŠ¸ë¥¼ ë°©ë¬¸í–ˆì„ ë•Œ í•´ë‹¹ ì›¹ì‚¬ì´íŠ¸ì˜ ì„œë²„ì—ì„œ ì—¬ëŸ¬ë¶„ì˜ ë¡œì»¬ í™˜ê²½ì— ì €ì¥í•˜ëŠ” ì‘ì€ ë°ì´í„°ë¥¼ ì˜ë¯¸í•¨. ì´ ê°’ì´ ìˆê¸° ë•Œë¬¸ì—
            ì´ì „ì— ë°©ë¬¸í•œ ì ì´ ìˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆê³ , ì´ì „ì— ë¡œê·¸ì¸ì„ í–ˆë‹¤ë©´ ë¡œê·¸ì¸ ì •ë³´ë„ ìœ ì§€í•  ìˆ˜ ìˆëŠ” ê²ƒì…ë‹ˆë‹¤. ì¿ í‚¤ëŠ” í‚¤ì™€ ê°’ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆìœ¼ë©°,
            ë§Œë£Œ ê¸°ê°„, ë„ë©”ì¸ ë“±ì˜ ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. HTTP ìš”ì²­ì„ í†µí•´ ì¿ í‚¤ì˜ íŠ¹ì • í‚¤ì— ê°’ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

                íë¦„                  GET /members
                    1. ë¸Œë¼ìš°ì €ì—ì„œ ìš”ì²­ -------------> 2. ì„œë²„ì—ì„œ ì¿ í‚¤ ì„¤ì •
                                                            |
                                                            â†“   Set-Cookie: member_id=1
                     4. GET /members  <--------------- 3. ë¸Œë¼ìš°ì €ì— ì¿ í‚¤ ì €ì¥
                        Cookie: member_id = 1


    ì¿ í‚¤ ê´€ë¦¬ í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í• ê²ë‹ˆë‹¤.
        OAuth2 ì¸ì¦ í”Œë¡œìš°ë¥¼ êµ¬í˜„í•˜ë©´ì„œ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•  ì¼ì´ ìƒê¹ë‹ˆë‹¤.
        ê·¸ë•Œë§ˆë‹¤ ì¿ í‚¤ë¥¼ ìƒì„±í•˜ê³  ì‚­ì œí•˜ëŠ” ë¡œì§ì„ ì¶”ê°€í•˜ë©´ ë¶ˆí¸í•´ì„œ
        ìœ í‹¸ë¦¬í‹°ë¡œ ì‚¬ìš©í•  ì¿ í‚¤ ê´€ë¦¬ í´ë˜ìŠ¤ë¥¼ ë¯¸ë¦¬ êµ¬í˜„

        springbootdeveloper íŒ¨í‚¤ì§€ ë‚´ì— util íŒ¨í‚¤ì§€ë¥¼ ìƒì„± -> CookieUtil.javaë¥¼ ìƒì„±
 */